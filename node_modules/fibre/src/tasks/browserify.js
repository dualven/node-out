module.exports = function(gulp, plugins, config) {

  function handleErrors() {
      var args = Array.prototype.slice.call(arguments);
      plugins.notify.onError({
        title: "JS Compile Error",
        message: "<%= error.message %>"
      }).apply(this, args);
      this.emit('end'); 
  };

  gulp.task('browserify', function () {
    var b = plugins.browserify({
      entries: config.jsSrcPath + '/main.js',
      debug: true
    });

    var stream = b.bundle();
    return stream.on('error', handleErrors)
        .pipe(plugins.vinylSourceStream('main.js'))
        .pipe(plugins.vinylBuffer())
        .pipe(plugins.sourcemaps.init({loadMaps: true}))
        .pipe(plugins.uglify())
        .pipe(plugins.sourcemaps.write('./'))
        .pipe(gulp.dest(config.jsDistPath));
  });

};